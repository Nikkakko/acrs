generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Staff {
  id           Int           @id @default(autoincrement())
  firstName    String
  lastName     String
  photoUrl     String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  reservations Reservation[]
}

model Service {
  id                 Int                       @id @default(autoincrement())
  name               String
  price              Decimal                   @db.Decimal(10, 2)
  color              String
  createdAt          DateTime                  @default(now())
  updatedAt          DateTime                  @updatedAt
  reservationLinks   ReservationService[]
  customFieldValues  ServiceCustomFieldValue[]
}

model ServiceCustomField {
  id        Int                       @id @default(autoincrement())
  name      String                    @unique
  createdAt DateTime                  @default(now())
  values    ServiceCustomFieldValue[]
}

model ServiceCustomFieldValue {
  serviceId Int
  fieldId   Int
  value     String                    @default("")
  service   Service                   @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  field     ServiceCustomField        @relation(fields: [fieldId], references: [id], onDelete: Cascade)

  @@id([serviceId, fieldId])
}

model ServiceColumnOrder {
  columnKey String @id
  position  Int
}

model Reservation {
  id               Int                  @id @default(autoincrement())
  specialistId     Int
  reservationDate  DateTime
  startTime        DateTime
  endTime          DateTime
  durationMin      Int
  createdAt        DateTime             @default(now())
  updatedAt        DateTime             @updatedAt
  specialist       Staff                @relation(fields: [specialistId], references: [id], onDelete: Cascade)
  serviceLinks     ReservationService[]

  @@index([reservationDate])
  @@index([specialistId])
}

model ReservationService {
  reservationId Int
  serviceId     Int
  sortOrder     Int
  reservation   Reservation @relation(fields: [reservationId], references: [id], onDelete: Cascade)
  service       Service     @relation(fields: [serviceId], references: [id], onDelete: Restrict)

  @@id([reservationId, serviceId])
}
